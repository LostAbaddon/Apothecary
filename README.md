# 求道的漫漫长路：洞天福地·修行研习

一款将“福地探索 + 洞天寻踪 + 修行研习”结合在一起的轻量 Rouge-lite 原型。前端基于 Vue 3 + Vite（Pinia 状态管理），当前仓库仅包含前端应用。

## 主要玩法

- 宗门经营：宗门概览、仓库、建筑入口与弟子管理
- 福地探索：开放世界探索，寻找洞天，遭遇邪修，偶遇魔界降世
- 洞天寻踪：扫雷式采集材料，结算带回宗门仓库
- 修行研习：研习卷宗以解封丹药、法器、功法、天书，以提升门派战斗力
- 邪修与魔：乱我道心者，皆是魔
- 战斗掉落：战斗胜利必定掉落矿石（5~20，中文名显示，进入“行囊”），且若仍有未解封卷宗则额外 80% 概率掉落一份“未解封卷宗”（进入“行囊”，不直接解封）；失败将按 20%~60% 比例随机掠夺行囊物品

### 弟子状态

- 驻守：可参与防御邪魔进攻
- 寻秘：在洞天福地搜寻奇遇、邪修与魔头
- 闭关：正在学习功法或提升境界
- 走火入魔：修炼功法或提升境界除了岔子

## 操作说明

- 福地移动：键盘 ↑ ↓ ← →
- 洞天寻踪：扫雷式找宝箱
- 修行研习：2048 式修炼与合成
- 查看队伍：福地信息面板右上角“⚔️”图标。

## 开发与运行

先决条件：Node.js 18+，npm 10+

常用命令：

```bash
# 启动前端（默认端口 8123）
npm run dev:frontend

# 或同时尝试前端+后端（无后端也可运行，后端脚本失败会被忽略）
npm run dev

# 构建前端产物
npm run build:frontend

# 清理依赖与构建产物
npm run clean
```

目录结构（当前以前端为主）

```
./
├─ frontend/                 # Vue 3 + Vite 前端应用
│  ├─ index.html             # 应用入口 HTML
│  ├─ vite.config.js         # Vite 配置
│  └─ src/
│     ├─ main.js             # 入口脚本，创建应用、挂载 Pinia 与路由
│     ├─ App.vue             # 根组件（含导航、KeepAlive）
│     ├─ style.css           # 全局样式（导航、网格、按钮等）
│     ├─ router/
│     │  └─ index.js         # 路由：/sect（宗门）、/map（福地）、/mining（洞天）、/alchemy（研习）等
│     ├─ store/
│     │  ├─ inventory.js     # 矿石入库与配方数据
│     │  ├─ heroes.js        # 求道者团队（地图上的队伍）
│     │  ├─ disciples.js     # 宗门弟子（初始化10名“驻守”）
│     │  ├─ scrolls.js       # 卷宗系统（丹药配方/法器秘术/玄门功法/符箓天书）
│     │  └─ game.js          # 全局状态（天数、队伍是否在宗门）
│     ├─ composables/
│     │  └─ toast.js         # 轻量提示（showToast + toasts 列表）
│     ├─ models/
│     │  ├─ ore.js           # 矿种模型/工具（ALL_ORES、ensureOres）
│     │  └─ realms.js        # 境界常量与工具函数（levelName）
│     └─ views/
│        ├─ SectView.vue     # 宗门：仓库/弟子管理/建筑入口
│        ├─ MapView.vue      # 福地：活力/天数、战争迷雾、移动/遭遇、队伍弹窗
│        ├─ MiningView.vue   # 洞天：扫雷式采集、随机掉落、自动结算
│        ├─ AlchemyView.vue  # 研习：2048 式合成与经验规则（卷宗研习接入）
│        ├─ PavilionView.vue # 龙吟阁：卷宗列表（未解封也显示种类）与研习入口
│        ├─ PillView.vue     # 蕴丹堂：丹药配方列表与“炼制”（消耗宗门仓库）
│        ├─ ForgeView.vue    # 凝器堂：法器秘术列表与“炼制”（消耗宗门仓库）
│        ├─ PlatformView.vue # 擎天台：玄门功法参悟（占位按钮模拟）
│        ├─ HallView.vue     # 参青殿：符箓天书悟道（占位按钮模拟）
│        ├─ BattleView.vue   # 战斗占位界面：胜利/失败模拟与结果结算
│        └─ InventoryView.vue# 行囊：库存与总量
├─ package.json              # 工作区/脚本（dev/build 等）
├─ README.md                 # 当前文档
└─ （可选）server/、shared/  # 预留目录（本仓库主要以前端为主）
```

**关键模块说明**

- `views/SectView.vue`
  - 宗门概览：财富/弟子/声望与仓库清单
  - 弟子管理：10 名初始“驻守”弟子；“派遣”→状态变“寻秘”并加入求道者队伍；“驻守”仅在队伍位于宗门时可用，点击将该弟子出队并回“驻守”
  - 建筑入口：蕴丹堂/凝器堂/擎天台/龙吟阁/参青殿
- `views/MapView.vue`
  - 视图：福地网格、标题“第N天/活力X/提示”、队伍弹窗
  - 机制：战争迷雾（已探索/当前可见）、活力与换天动画、邪修遭遇→战斗界面、洞天入口随机
  - 队伍：从 heroes 仓库读取；初始为 0 人；队伍为 0 时“福地寻秘”导航禁用；队伍是否在宗门用于控制“驻守”可用性
- `views/MiningView.vue`
  - 交互：左/右键规则、随机采集数量（1..oreFindMax，默认 100）、自动“仅余矿格”结算
  - 结算：入行囊并显示弹窗，“离开洞天”返回福地；洞天期间顶部导航禁用
- `views/AlchemyView.vue`
  - 玩法：彩虹循环合成；同矿叠加经验、异矿取高；满足配方即“研习成功”
  - 卷宗研习：未解封→解封；已解封→生成“新成本”并与“原成本”二选一（丹/法器写入 cost，功法/真经写入 consume）
- `views/BattleView.vue`
  - 战斗占位界面，模拟胜败并结算奖励/惩罚
  - 掉落机制（胜利）：
    - 必定获得一份矿石奖励（随机矿种，数量 5~20），奖励进入“行囊”，日志以矿种中文名显示（不出现“矿石”字样）
    - 若仍有“未解封”的卷宗，则额外以 80% 概率掉落其中一份“未解封卷宗”（进入“行囊”），不直接解封
  - 失败惩罚：按 20%~60% 的比例随机扣减“行囊”中的物品（若为空则无变化）
- `store/inventory.js`
  - `inventory` 聚合入库；`recipes/selectedRecipe` 用于研习配方
- `store/heroes.js`
  - 求道者队伍（地图上的可移动队伍），提供成员管理与去重添加
- `store/disciples.js`
  - 宗门弟子（独立于求道者队伍），初始化 10 名“驻守”弟子
- `store/scrolls.js`
  - 卷宗系统：管理卷宗解封状态与成本（cost/consume）
- `store/game.js`
  - 全局状态：天数与 `heroAtVillage`（队伍是否在宗门）
- `composables/toast.js`
  - `showToast(message, {type, duration})` 与 `toasts` 列表（Map/Mining 共用）
- `models/ore.js`
  - `ALL_ORES`（矿池）、`ensureOres`（规范化矿种）

## 备注与后续计划

- 邪修遭遇已切换为“战斗界面”占位（左右两侧站位与胜负按钮），后续替换为正式战棋规则。
- 福地事件、天气/时间加成、道路与更多地形将逐步加入。
- 研习配方与矿种将可配置化，本地化文本完善中。

## 贡献与提交

- 建议使用约定式提交（Conventional Commits），并在标题中标注范围，如 `feat(map)`、`feat(mining)`。
- 对玩法变更请附上简述与必要的截图/录屏。

# TODO

- 福地探索
  + 邪修交战界面
    * 邪修攻击成功则抢夺行囊
    * 攻击邪修成功则有概率获取修炼秘籍、法器、内丹等各种宝物
  + 魔界入口，每天随机出现（是否出现以及在哪里出现都随机）
  + 更多地形，且不同等级的求道者可以通过的地形不同，团队移动时以等级最低求道者为准
  + 森林、山脉等等地形要尽可能连续
- 洞天寻踪
  + 增加宝箱、高人遗功等物件
- 修行研习
  + 四大基础建筑的功能实现

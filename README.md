# Apothecary: 炼金工房

本项目是一款结合了“扫雷”和“2048”玩法的游戏，前端基于 Vue.js，后端基于 Node.js。

## 游戏玩法

游戏分为两个核心部分：挖矿和炼金。

### 1. 挖矿

此阶段玩法类似扫雷，但目标是寻找矿石而非地雷。

- 你有**有限次**翻开格子的机会。
- **左键点击**空格子，会像扫雷一样翻开周围区域。
- **左键点击**有矿石的格子，矿石会碎裂，并消耗一次机会。
- **右键点击**有矿石的格子，会成功采集矿石，并消耗一次机会。
- **右键点击**空格子，同样会消耗一次机会并翻开区域。

当所有机会用完后，本回合结束，所有采集到的矿石（共五种，随机出现）会进入你的仓库。

### 2. 炼金

在此阶段，你将使用仓库中的矿石，根据“配方”来合成道具。核心玩法类似 2048，但合并规则基于彩虹色谱。

- **颜色合并**: 两个“赤”合成一个“橙”，两个“橙”合成一个“黄”，以此类推（赤→橙→黄→绿→青→蓝→紫）。最后两个“紫”会合成为一个“赤”，构成一个循环。
- **矿石合并**: 每个色块都包含一块初始“经验值”为 1 的矿石。
  - 合并时，如果两块矿石**种类相同**，新矿石的经验值为两者之和。
  - 如果两块矿石**种类不同**，则保留经验值**最高**的那块矿石。
- **胜利条件**: 当炼金棋盘中的矿石满足配方要求时，炼金成功。例如，某配方要求 A 矿石经验值不小于 10，B 矿石不小于 20，你需要通过合并操作，使棋盘内至少有一块 A 矿石经验值达到 10，且至少有一块 B 矿石经验值达到 20。

## 项目结构

- `frontend/`: Vue 3 + Vite 前端应用。
  - `src/game/`: 包含 `minefield/` (扫雷) 和 `alchemy/` (炼金) 的核心游戏逻辑。
- `server/`: Node.js 后端 (Express/Fastify)。
  - `src/game/`: 与前端共享的纯函数游戏规则。
- `shared/`: 前后端共享的代码，如常量、类型、配方等。
- `tests/`: 单元和集成测试。
- `e2e/`: Playwright 端到端测试。
- `docs/`: 游戏规则、配方和设计文档。

## 开发设置

### 先决条件

- Node.js
- npm (或兼容的包管理器)

### 主要命令

```bash
# 同时运行前端和后端
npm run dev

# 单独运行前端开发服务器
npm run dev -w frontend

# 单独运行后端 API (带热更新)
npm run dev -w server

# 构建前端应用
npm run build -w frontend

# 构建后端服务
npm run build -w server

# 运行前端单元测试
npm run test:unit -w frontend

# 运行后端测试
npm run test -w server

# 运行端到端测试
npm run test:e2e

# 对所有包进行代码检查
npm run lint -ws

# 格式化所有包的代码
npm run format -ws
```

## 贡献指南

- **提交**: 请遵循 [约定式提交 (Conventional Commits)](https.www.conventionalcommits.org/) 规范。
  - 提交信息前缀应为 `feat:`, `fix:`, `refactor:`, `docs:`, `test:` 等。
  - 注明影响范围，如 `feat([alchemy]): ...`。
- **拉取请求 (Pull Requests)**:
  - 提供清晰的变更描述。
  - 关联相关 issue (例如 `Closes #123`)。
  - 对游戏玩法变更附上截图或 GIF。
  - 确保测试和文档已更新。
